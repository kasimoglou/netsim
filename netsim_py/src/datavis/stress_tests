#! /bin/sh


if test $# -ne= 1 
then
  echo Error: you must provide a url as the sole argument!
  echo 
  echo usage:  stress_test '<server url>'
  echo
  echo Example:  ./stress_test http://localhost:18880
  exit 1
fi

echo ==================================================================================
echo Stress testing admin web server at url $1
echo ==================================================================================

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 1: /admin: Tests the web server.
echo -----------------------------------------------------------------------------------
ab -q -n 1000 -c 10 $1/admin

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 2: Read /jobs.html: Tests the database backend and the web server.
echo -----------------------------------------------------------------------------------
ab -q -n 1000 -c 10 $1/admin/jobs.html

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 3: /admin/nsd_table.html: Tests the project repo and the web server.
echo -----------------------------------------------------------------------------------
ab -q -n 1000 -c 10 $1/admin/nsd_table.html


echo ==================================================================================
echo Stress ReST api at url $1
echo ==================================================================================

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 4: GET /api/nsd
echo -----------------------------------------------------------------------------------
ab -q -n 1000 -c 10 $1/api/nsd

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 5: GET /api/projects
echo -----------------------------------------------------------------------------------
ab -q -n 1000 -c 10 $1/api/projects

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 6: GET /api/nsd/nsd_sample
echo -----------------------------------------------------------------------------------
ab -q -n 1000 -c 10 $1/api/nsd/nsd_sample

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 7: GET /api/nsd/no_such_nsd:  Tests error response
echo -----------------------------------------------------------------------------------
ab -q -n 100 -c 10 $1/api/nsd/no_such_nsd

echo 
echo
echo -----------------------------------------------------------------------------------
echo Test 8: /api/foo_path:  Tests error response
echo -----------------------------------------------------------------------------------
ab -q -n 1000 -c 10 $1/api/foo_path

